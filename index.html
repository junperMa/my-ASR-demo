<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³å®æ—¶è½¬æ–‡å­—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
        }

        .status {
            margin-bottom: 30px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status.ready {
            background: #e8f5e8;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        .status.listening {
            background: #fff3e0;
            color: #f57c00;
            border: 2px solid #ff9800;
            animation: pulse 1.5s infinite;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .controls {
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn.recording {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            animation: pulse 1.5s infinite;
        }

        .transcript-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 200px;
            text-align: left;
            border: 2px solid #e9ecef;
        }

        .transcript {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .transcript.empty {
            color: #6c757d;
            font-style: italic;
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .action-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .language-selector {
            margin-bottom: 20px;
        }

        .language-selector select {
            padding: 10px 15px;
            border-radius: 25px;
            border: 2px solid #e9ecef;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            color: #1976d2;
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            color: #c62828;
        }

        .network-status.success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }

        .network-status.warning {
            background: #fff3e0;
            border: 1px solid #ff9800;
            color: #f57c00;
        }

        .network-status.error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }

        .network-info {
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .btn {
                padding: 12px 24px;
                font-size: 16px;
                margin: 5px;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ è¯­éŸ³å®æ—¶è½¬æ–‡å­—</h1>
        
        <div class="language-selector">
            <select id="languageSelect">
                <option value="zh-CN">ä¸­æ–‡ (ç®€ä½“)</option>
                <option value="en-US">English (US)</option>
                <option value="ja-JP">æ—¥æœ¬èª</option>
                <option value="ko-KR">í•œêµ­ì–´</option>
                <option value="fr-FR">FranÃ§ais</option>
                <option value="de-DE">Deutsch</option>
                <option value="es-ES">EspaÃ±ol</option>
            </select>
        </div>

        <div id="status" class="status ready">
            å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»å¼€å§‹å½•éŸ³
        </div>

        <div class="controls">
            <button id="startBtn" class="btn">å¼€å§‹å½•éŸ³</button>
            <button id="stopBtn" class="btn" disabled>åœæ­¢å½•éŸ³</button>
        </div>

        <div class="transcript-container">
            <div id="transcript" class="transcript empty">
                å½•éŸ³å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>

        <div class="actions">
            <button id="clearBtn" class="action-btn">æ¸…ç©ºå†…å®¹</button>
            <button id="copyBtn" class="action-btn">å¤åˆ¶æ–‡å­—</button>
            <button id="downloadBtn" class="action-btn">ä¸‹è½½æ–‡å­—</button>
        </div>

        <div class="info">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
            1. é€‰æ‹©è¯­è¨€ï¼ˆé»˜è®¤ä¸ºä¸­æ–‡ç®€ä½“ï¼‰<br>
            2. ç‚¹å‡»"å¼€å§‹å½•éŸ³"æŒ‰é’®å¼€å§‹è¯­éŸ³è¯†åˆ«<br>
            3. è¯´è¯æ—¶è¯·ä¿æŒæ¸…æ™°çš„å‘éŸ³<br>
            4. ç‚¹å‡»"åœæ­¢å½•éŸ³"ç»“æŸè¯†åˆ«<br>
            5. å¯ä»¥æ¸…ç©ºã€å¤åˆ¶æˆ–ä¸‹è½½è¯†åˆ«ç»“æœ
        </div>

        <div class="info" style="margin-top: 15px;">
            <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong><br>
            â€¢ è¯­éŸ³è¯†åˆ«éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥<br>
            â€¢ å»ºè®®ä½¿ç”¨HTTPSç¯å¢ƒï¼ˆæ›´ç¨³å®šï¼‰<br>
            â€¢ å¦‚æœå‡ºç°ç½‘ç»œé”™è¯¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡è¯•<br>
            â€¢ æ”¯æŒChromeã€Edgeã€Safariæµè§ˆå™¨
        </div>

        <div id="networkStatus" class="info" style="margin-top: 15px; display: none;">
            <strong>ğŸŒ ç½‘ç»œçŠ¶æ€ï¼š</strong><br>
            <span id="networkInfo">æ£€æµ‹ä¸­...</span>
        </div>
    </div>

    <script>
        class SpeechRecognitionApp {
            constructor() {
                console.log('ğŸš€ åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«åº”ç”¨...');
                this.recognition = null;
                this.isRecording = false;
                this.transcript = '';
                this.currentLanguage = 'zh-CN';
                
                this.initElements();
                this.initSpeechRecognition();
                this.bindEvents();
                this.checkNetworkStatus();
                this.checkEnvironmentCompatibility(); // æ–°å¢ç¯å¢ƒå…¼å®¹æ€§æ£€æŸ¥
                console.log('âœ… è¯­éŸ³è¯†åˆ«åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
            }

            initElements() {
                console.log('ğŸ” åˆå§‹åŒ–DOMå…ƒç´ ...');
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.status = document.getElementById('status');
                this.transcriptElement = document.getElementById('transcript');
                this.languageSelect = document.getElementById('languageSelect');
                this.clearBtn = document.getElementById('clearBtn');
                this.copyBtn = document.getElementById('copyBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.networkStatus = document.getElementById('networkStatus');
                this.networkInfo = document.getElementById('networkInfo');
                
                // æ£€æŸ¥æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½è·å–æˆåŠŸ
                const elements = {
                    startBtn: this.startBtn,
                    stopBtn: this.stopBtn,
                    status: this.status,
                    transcriptElement: this.transcriptElement,
                    languageSelect: this.languageSelect,
                    clearBtn: this.clearBtn,
                    copyBtn: this.copyBtn,
                    downloadBtn: this.downloadBtn,
                    networkStatus: this.networkStatus,
                    networkInfo: this.networkInfo
                };
                
                Object.entries(elements).forEach(([name, element]) => {
                    if (element) {
                        console.log(`âœ… ${name}: è·å–æˆåŠŸ`);
                    } else {
                        console.error(`âŒ ${name}: è·å–å¤±è´¥`);
                    }
                });
            }

            initSpeechRecognition() {
                console.log('ğŸ¤ åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«...');
                
                // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                console.log('ğŸ” æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ:', {
                    'window.SpeechRecognition': !!window.SpeechRecognition,
                    'window.webkitSpeechRecognition': !!window.webkitSpeechRecognition,
                    'SpeechRecognition': !!SpeechRecognition
                });
                
                if (!SpeechRecognition) {
                    console.error('âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«');
                    this.showError('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨Chromeã€Edgeæˆ–Safariæµè§ˆå™¨ã€‚');
                    return;
                }

                console.log('âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œåˆ›å»ºå®ä¾‹...');
                this.recognition = new SpeechRecognition();
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = this.currentLanguage;
                
                console.log('ğŸ“ è¯­éŸ³è¯†åˆ«é…ç½®:', {
                    continuous: this.recognition.continuous,
                    interimResults: this.recognition.interimResults,
                    lang: this.recognition.lang
                });

                this.recognition.onstart = () => {
                    console.log('ğŸ¯ è¯­éŸ³è¯†åˆ«å¼€å§‹äº‹ä»¶è§¦å‘');
                    this.isRecording = true;
                    this.updateUI();
                    this.updateStatus('æ­£åœ¨å½•éŸ³...', 'listening');
                    console.log('âœ… å½•éŸ³çŠ¶æ€å·²æ›´æ–°ï¼Œå½“å‰çŠ¶æ€:', this.isRecording);
                };

                this.recognition.onresult = (event) => {
                    console.log('ğŸµ è¯­éŸ³è¯†åˆ«ç»“æœäº‹ä»¶è§¦å‘');
                    console.log('ğŸ“Š äº‹ä»¶è¯¦æƒ…:', {
                        resultIndex: event.resultIndex,
                        resultsLength: event.results.length,
                        event: event
                    });
                    
                    let finalTranscript = '';
                    let interimTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const result = event.results[i];
                        const transcript = result[0].transcript;
                        const isFinal = result.isFinal;
                        
                        console.log(`ğŸ“ ç»“æœ ${i}:`, {
                            transcript: transcript,
                            isFinal: isFinal,
                            confidence: result[0].confidence
                        });
                        
                        if (isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    console.log('ğŸ“‹ å¤„ç†ç»“æœ:', {
                        finalTranscript: finalTranscript,
                        interimTranscript: interimTranscript,
                        currentTranscript: this.transcript
                    });

                    if (finalTranscript) {
                        this.transcript += finalTranscript + '\n';
                        console.log('âœ… æœ€ç»ˆæ–‡å­—å·²æ·»åŠ åˆ°è®°å½•ä¸­');
                    }

                    this.updateTranscript();
                };

                this.recognition.onerror = (event) => {
                    console.error('âŒ è¯­éŸ³è¯†åˆ«é”™è¯¯äº‹ä»¶è§¦å‘:', event.error);
                    console.log('ğŸš¨ é”™è¯¯è¯¦æƒ…:', event);
                    
                    let errorMessage = 'è¯­éŸ³è¯†åˆ«å‡ºç°é”™è¯¯';
                    let shouldRetry = false;
                    
                    switch (event.error) {
                        case 'no-speech':
                            errorMessage = 'æ²¡æœ‰æ£€æµ‹åˆ°è¯­éŸ³ï¼Œè¯·è¯´è¯';
                            break;
                        case 'audio-capture':
                            errorMessage = 'æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®';
                            break;
                        case 'not-allowed':
                            errorMessage = 'éº¦å…‹é£è®¿é—®è¢«æ‹’ç»ï¼Œè¯·å…è®¸è®¿é—®éº¦å…‹é£';
                            break;
                        case 'network':
                            errorMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯­éŸ³è¯†åˆ«æœåŠ¡æ— æ³•è®¿é—®ã€‚è¯·æ£€æŸ¥ï¼š1) ç½‘ç»œè¿æ¥ 2) æ˜¯å¦ä½¿ç”¨HTTPS 3) é˜²ç«å¢™è®¾ç½®';
                            shouldRetry = true;
                            break;
                        case 'aborted':
                            errorMessage = 'è¯­éŸ³è¯†åˆ«è¢«ä¸­æ–­';
                            break;
                        case 'audio-not-allowed':
                            errorMessage = 'éŸ³é¢‘è®¿é—®è¢«æ‹’ç»';
                            break;
                        case 'bad-grammar':
                            errorMessage = 'è¯­æ³•é”™è¯¯';
                            break;
                        case 'language-not-supported':
                            errorMessage = 'ä¸æ”¯æŒçš„è¯­è¨€';
                            break;
                        case 'service-not-allowed':
                            errorMessage = 'è¯­éŸ³è¯†åˆ«æœåŠ¡è¢«æ‹’ç»';
                            break;
                        default:
                            errorMessage = `è¯†åˆ«é”™è¯¯: ${event.error}`;
                    }
                    
                    console.log('ğŸ’¬ é”™è¯¯æ¶ˆæ¯:', errorMessage);
                    console.log('ğŸ”„ æ˜¯å¦åº”è¯¥é‡è¯•:', shouldRetry);
                    
                    this.showError(errorMessage);
                    
                    if (shouldRetry && this.isRecording) {
                        console.log('ğŸ”„ ç½‘ç»œé”™è¯¯ï¼Œ3ç§’åå°è¯•é‡æ–°è¿æ¥...');
                        setTimeout(() => {
                            if (this.isRecording) {
                                console.log('ğŸ”„ å°è¯•é‡æ–°å¯åŠ¨è¯­éŸ³è¯†åˆ«...');
                                this.startRecording();
                            }
                        }, 3000);
                    } else {
                        this.stopRecording();
                    }
                };

                this.recognition.onend = () => {
                    console.log('ğŸ”š è¯­éŸ³è¯†åˆ«ç»“æŸäº‹ä»¶è§¦å‘');
                    console.log('ğŸ“Š å½“å‰å½•éŸ³çŠ¶æ€:', this.isRecording);
                    
                    if (this.isRecording) {
                        console.log('ğŸ”„ å½•éŸ³ä»åœ¨è¿›è¡Œï¼Œé‡æ–°å¯åŠ¨è¯­éŸ³è¯†åˆ«...');
                        // å¦‚æœè¿˜åœ¨å½•éŸ³çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹
                        try {
                            this.recognition.start();
                            console.log('âœ… è¯­éŸ³è¯†åˆ«å·²é‡æ–°å¯åŠ¨');
                        } catch (error) {
                            console.error('âŒ é‡æ–°å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:', error);
                        }
                    } else {
                        console.log('â¹ï¸ å½•éŸ³å·²åœæ­¢ï¼Œä¸é‡æ–°å¯åŠ¨');
                    }
                };
            }

            bindEvents() {
                console.log('ğŸ”— ç»‘å®šäº‹ä»¶ç›‘å¬å™¨...');
                
                this.startBtn.addEventListener('click', () => {
                    console.log('ğŸ–±ï¸ å¼€å§‹å½•éŸ³æŒ‰é’®è¢«ç‚¹å‡»');
                    this.startRecording();
                });
                
                this.stopBtn.addEventListener('click', () => {
                    console.log('ğŸ–±ï¸ åœæ­¢å½•éŸ³æŒ‰é’®è¢«ç‚¹å‡»');
                    this.stopRecording();
                });
                
                this.clearBtn.addEventListener('click', () => {
                    console.log('ğŸ–±ï¸ æ¸…ç©ºå†…å®¹æŒ‰é’®è¢«ç‚¹å‡»');
                    this.clearTranscript();
                });
                
                this.copyBtn.addEventListener('click', () => {
                    console.log('ğŸ–±ï¸ å¤åˆ¶æ–‡å­—æŒ‰é’®è¢«ç‚¹å‡»');
                    this.copyTranscript();
                });
                
                this.downloadBtn.addEventListener('click', () => {
                    console.log('ğŸ–±ï¸ ä¸‹è½½æ–‡å­—æŒ‰é’®è¢«ç‚¹å‡»');
                    this.downloadTranscript();
                });
                
                this.languageSelect.addEventListener('change', (e) => {
                    console.log('ğŸ–±ï¸ è¯­è¨€é€‰æ‹©æ”¹å˜:', e.target.value);
                    this.changeLanguage(e.target.value);
                });
                
                console.log('âœ… æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ç»‘å®šå®Œæˆ');
            }

            startRecording() {
                console.log('ğŸ¤ å¼€å§‹å½•éŸ³æ–¹æ³•è¢«è°ƒç”¨');
                console.log('ğŸ“Š å½“å‰çŠ¶æ€:', {
                    recognition: !!this.recognition,
                    isRecording: this.isRecording,
                    currentLanguage: this.currentLanguage
                });
                
                // æ£€æŸ¥ç½‘ç»œè¿æ¥
                if (!navigator.onLine) {
                    console.error('âŒ ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œæ— æ³•å¯åŠ¨è¯­éŸ³è¯†åˆ«');
                    this.showError('ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•');
                    return;
                }
                
                if (!this.recognition) {
                    console.error('âŒ è¯­éŸ³è¯†åˆ«æœªåˆå§‹åŒ–');
                    this.showError('è¯­éŸ³è¯†åˆ«æœªåˆå§‹åŒ–');
                    return;
                }

                try {
                    console.log('ğŸš€ å°è¯•å¯åŠ¨è¯­éŸ³è¯†åˆ«...');
                    this.recognition.start();
                    console.log('âœ… è¯­éŸ³è¯†åˆ«å¯åŠ¨å‘½ä»¤å·²å‘é€');
                } catch (error) {
                    console.error('âŒ å¯åŠ¨å½•éŸ³å¤±è´¥:', error);
                    this.showError('å¯åŠ¨å½•éŸ³å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            }

            stopRecording() {
                console.log('â¹ï¸ åœæ­¢å½•éŸ³æ–¹æ³•è¢«è°ƒç”¨');
                console.log('ğŸ“Š åœæ­¢å‰çŠ¶æ€:', {
                    recognition: !!this.recognition,
                    isRecording: this.isRecording
                });
                
                if (this.recognition) {
                    console.log('ğŸ›‘ åœæ­¢è¯­éŸ³è¯†åˆ«...');
                    this.recognition.stop();
                    console.log('âœ… è¯­éŸ³è¯†åˆ«åœæ­¢å‘½ä»¤å·²å‘é€');
                }
                
                this.isRecording = false;
                this.updateUI();
                this.updateStatus('å½•éŸ³å·²åœæ­¢', 'ready');
                console.log('ğŸ“Š åœæ­¢åçŠ¶æ€:', {
                    isRecording: this.isRecording
                });
            }

            changeLanguage(language) {
                console.log('ğŸŒ åˆ‡æ¢è¯­è¨€æ–¹æ³•è¢«è°ƒç”¨:', language);
                console.log('ğŸ“Š åˆ‡æ¢å‰è¯­è¨€:', this.currentLanguage);
                
                this.currentLanguage = language;
                if (this.recognition) {
                    console.log('ğŸ”„ æ›´æ–°è¯­éŸ³è¯†åˆ«è¯­è¨€è®¾ç½®...');
                    this.recognition.lang = language;
                    console.log('âœ… è¯­éŸ³è¯†åˆ«è¯­è¨€å·²æ›´æ–°ä¸º:', language);
                }
                
                const languageName = this.getLanguageName(language);
                this.updateStatus(`è¯­è¨€å·²åˆ‡æ¢ä¸º: ${languageName}`, 'ready');
                console.log('ğŸ“Š åˆ‡æ¢åè¯­è¨€:', this.currentLanguage);
            }

            getLanguageName(code) {
                const languages = {
                    'zh-CN': 'ä¸­æ–‡ç®€ä½“',
                    'en-US': 'English',
                    'ja-JP': 'æ—¥æœ¬èª',
                    'ko-KR': 'í•œêµ­ì–´',
                    'fr-FR': 'FranÃ§ais',
                    'de-DE': 'Deutsch',
                    'es-ES': 'EspaÃ±ol'
                };
                return languages[code] || code;
            }

            updateUI() {
                console.log('ğŸ¨ æ›´æ–°UIæ–¹æ³•è¢«è°ƒç”¨');
                console.log('ğŸ“Š å½“å‰å½•éŸ³çŠ¶æ€:', this.isRecording);
                
                if (this.isRecording) {
                    console.log('ğŸ”´ è®¾ç½®å½•éŸ³ä¸­çŠ¶æ€...');
                    this.startBtn.disabled = true;
                    this.startBtn.classList.add('recording');
                    this.startBtn.textContent = 'å½•éŸ³ä¸­...';
                    this.stopBtn.disabled = false;
                    console.log('âœ… å½•éŸ³ä¸­çŠ¶æ€è®¾ç½®å®Œæˆ');
                } else {
                    console.log('ğŸŸ¢ è®¾ç½®å‡†å¤‡çŠ¶æ€...');
                    this.startBtn.disabled = false;
                    this.startBtn.classList.remove('recording');
                    this.startBtn.textContent = 'å¼€å§‹å½•éŸ³';
                    this.stopBtn.disabled = true;
                    console.log('âœ… å‡†å¤‡çŠ¶æ€è®¾ç½®å®Œæˆ');
                }
            }

            updateStatus(message, type) {
                console.log('ğŸ“ æ›´æ–°çŠ¶æ€æ–¹æ³•è¢«è°ƒç”¨:', { message, type });
                this.status.textContent = message;
                this.status.className = `status ${type}`;
                console.log('âœ… çŠ¶æ€å·²æ›´æ–°ä¸º:', message);
            }

            updateTranscript() {
                console.log('ğŸ“‹ æ›´æ–°æ–‡å­—æ˜¾ç¤ºæ–¹æ³•è¢«è°ƒç”¨');
                console.log('ğŸ“Š å½“å‰æ–‡å­—å†…å®¹:', {
                    transcript: this.transcript,
                    transcriptLength: this.transcript.length,
                    hasContent: !!this.transcript.trim()
                });
                
                if (this.transcript.trim()) {
                    console.log('ğŸ“ æ˜¾ç¤ºè¯†åˆ«æ–‡å­—...');
                    this.transcriptElement.textContent = this.transcript;
                    this.transcriptElement.classList.remove('empty');
                    console.log('âœ… æ–‡å­—æ˜¾ç¤ºå·²æ›´æ–°');
                } else {
                    console.log('ğŸ“ æ˜¾ç¤ºé»˜è®¤æç¤ºæ–‡å­—...');
                    this.transcriptElement.textContent = 'å½•éŸ³å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
                    this.transcriptElement.classList.add('empty');
                    console.log('âœ… é»˜è®¤æç¤ºæ–‡å­—å·²æ˜¾ç¤º');
                }
            }

            clearTranscript() {
                console.log('ğŸ—‘ï¸ æ¸…ç©ºæ–‡å­—æ–¹æ³•è¢«è°ƒç”¨');
                console.log('ğŸ“Š æ¸…ç©ºå‰æ–‡å­—é•¿åº¦:', this.transcript.length);
                
                this.transcript = '';
                this.updateTranscript();
                this.updateStatus('å†…å®¹å·²æ¸…ç©º', 'ready');
                
                console.log('âœ… æ–‡å­—å·²æ¸…ç©ºï¼Œå½“å‰é•¿åº¦:', this.transcript.length);
            }

            async copyTranscript() {
                console.log('ğŸ“‹ å¤åˆ¶æ–‡å­—æ–¹æ³•è¢«è°ƒç”¨');
                console.log('ğŸ“Š å½“å‰æ–‡å­—é•¿åº¦:', this.transcript.length);
                
                if (!this.transcript.trim()) {
                    console.log('âŒ æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
                    this.updateStatus('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶', 'error');
                    return;
                }

                try {
                    console.log('ğŸ“‹ å°è¯•ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API...');
                    await navigator.clipboard.writeText(this.transcript);
                    this.updateStatus('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'ready');
                    console.log('âœ… æ–‡å­—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } catch (error) {
                    console.log('âš ï¸ ç°ä»£å‰ªè´´æ¿APIå¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ:', error);
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = this.transcript;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    this.updateStatus('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'ready');
                    console.log('âœ… ä½¿ç”¨é™çº§æ–¹æ¡ˆå¤åˆ¶æˆåŠŸ');
                }
            }

            downloadTranscript() {
                console.log('ğŸ’¾ ä¸‹è½½æ–‡å­—æ–¹æ³•è¢«è°ƒç”¨');
                console.log('ğŸ“Š å½“å‰æ–‡å­—é•¿åº¦:', this.transcript.length);
                
                if (!this.transcript.trim()) {
                    console.log('âŒ æ²¡æœ‰å†…å®¹å¯ä¸‹è½½');
                    this.updateStatus('æ²¡æœ‰å†…å®¹å¯ä¸‹è½½', 'error');
                    return;
                }

                console.log('ğŸ“ åˆ›å»ºä¸‹è½½æ–‡ä»¶...');
                const blob = new Blob([this.transcript], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `è¯­éŸ³è½¬æ–‡å­—_${new Date().toLocaleString('zh-CN').replace(/[\/\s:]/g, '_')}.txt`;
                
                console.log('ğŸ“¥ è§¦å‘ä¸‹è½½...');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.updateStatus('æ–‡ä»¶å·²ä¸‹è½½', 'ready');
                console.log('âœ… æ–‡ä»¶ä¸‹è½½å®Œæˆ');
            }

            showError(message) {
                console.log('ğŸš¨ æ˜¾ç¤ºé”™è¯¯æ–¹æ³•è¢«è°ƒç”¨:', message);
                this.updateStatus(message, 'error');
                
                console.log('â° è®¾ç½®3ç§’åæ¢å¤é»˜è®¤çŠ¶æ€...');
                setTimeout(() => {
                    this.updateStatus('å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»å¼€å§‹å½•éŸ³', 'ready');
                    console.log('âœ… çŠ¶æ€å·²æ¢å¤åˆ°é»˜è®¤');
                }, 3000);
            }

            checkNetworkStatus() {
                console.log('ğŸŒ æ£€æŸ¥ç½‘ç»œçŠ¶æ€...');
                
                // æ˜¾ç¤ºç½‘ç»œçŠ¶æ€åŒºåŸŸ
                if (this.networkStatus) {
                    this.networkStatus.style.display = 'block';
                }
                
                // æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€
                if (navigator.onLine) {
                    console.log('âœ… ç½‘ç»œè¿æ¥æ­£å¸¸');
                    this.updateNetworkInfo('ğŸŸ¢ ç½‘ç»œè¿æ¥æ­£å¸¸', 'success');
                } else {
                    console.log('âŒ ç½‘ç»œè¿æ¥æ–­å¼€');
                    this.updateNetworkInfo('ğŸ”´ ç½‘ç»œè¿æ¥æ–­å¼€', 'error');
                }
                
                // æ£€æµ‹HTTPSçŠ¶æ€
                const isHttps = window.location.protocol === 'https:';
                console.log('ğŸ”’ HTTPSçŠ¶æ€:', isHttps);
                
                if (isHttps) {
                    this.updateNetworkInfo('ğŸŸ¢ ç½‘ç»œè¿æ¥æ­£å¸¸ | ğŸ”’ HTTPSå®‰å…¨è¿æ¥', 'success');
                } else {
                    this.updateNetworkInfo('ğŸŸ¡ ç½‘ç»œè¿æ¥æ­£å¸¸ | âš ï¸ HTTPè¿æ¥ï¼ˆå»ºè®®ä½¿ç”¨HTTPSï¼‰', 'warning');
                }
                
                // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
                window.addEventListener('online', () => {
                    console.log('ğŸŒ ç½‘ç»œå·²è¿æ¥');
                    this.updateNetworkInfo('ğŸŸ¢ ç½‘ç»œå·²è¿æ¥', 'success');
                });
                
                window.addEventListener('offline', () => {
                    console.log('ğŸŒ ç½‘ç»œå·²æ–­å¼€');
                    this.updateNetworkInfo('ğŸ”´ ç½‘ç»œå·²æ–­å¼€', 'error');
                });
            }
            
            updateNetworkInfo(message, type) {
                if (this.networkInfo) {
                    this.networkInfo.textContent = message;
                    this.networkInfo.className = `network-info ${type}`;
                }
                
                // æ·»åŠ æ ·å¼ç±»
                if (this.networkStatus) {
                    this.networkStatus.className = `info network-status ${type}`;
                }
            }

            checkEnvironmentCompatibility() {
                console.log('ğŸ” æ£€æŸ¥ç¯å¢ƒå…¼å®¹æ€§...');
                const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
                const isEdge = /Edg/.test(navigator.userAgent);
                const isSafari = /Safari/.test(navigator.userAgent) && !isChrome && !isEdge;

                console.log('ğŸŒ å½“å‰æµè§ˆå™¨:', {
                    'Chrome': isChrome,
                    'Edge': isEdge,
                    'Safari': isSafari
                });

                if (!isChrome && !isEdge && !isSafari) {
                    console.warn('âš ï¸ è­¦å‘Šï¼šæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½ã€‚å»ºè®®ä½¿ç”¨Chromeã€Edgeæˆ–Safariæµè§ˆå™¨ã€‚');
                    this.showError('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½ã€‚å»ºè®®ä½¿ç”¨Chromeã€Edgeæˆ–Safariæµè§ˆå™¨ã€‚');
                } else {
                    console.log('âœ… ç¯å¢ƒå…¼å®¹æ€§æ£€æŸ¥é€šè¿‡');
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“„ é¡µé¢DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–åº”ç”¨...');
            try {
                new SpeechRecognitionApp();
                console.log('ğŸ‰ åº”ç”¨åˆå§‹åŒ–æˆåŠŸï¼');
            } catch (error) {
                console.error('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        });
    </script>
</body>
</html>
